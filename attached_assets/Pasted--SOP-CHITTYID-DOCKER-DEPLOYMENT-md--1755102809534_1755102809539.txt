 SOP_CHITTYID_DOCKER_DEPLOYMENT.md                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Standard Operating Procedure: ChittyID Docker Container Deployment                                                                                                                                                        │ │
│ │                                                                                                                                                                                                                             │ │
│ │ **Document ID**: SOP-DEPLOY-002                                                                                                                                                                                             │ │
│ │ **Version**: 1.0                                                                                                                                                                                                            │ │
│ │ **Effective Date**: 2025-08-13                                                                                                                                                                                              │ │
│ │ **Review Cycle**: Quarterly                                                                                                                                                                                                 │ │
│ │ **Owner**: DevOps Team Lead                                                                                                                                                                                                 │ │
│ │ **Approved By**: ___________________ Date: ___________                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ## 1. PURPOSE AND SCOPE                                                                                                                                                                                                     │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 1.1 Purpose                                                                                                                                                                                                             │ │
│ │ This SOP provides standardized procedures for building, deploying, and managing ChittyID as a containerized application using Docker, ensuring consistency across development, staging, and production environments.        │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 1.2 Scope                                                                                                                                                                                                               │ │
│ │ This procedure covers:                                                                                                                                                                                                      │ │
│ │ - Docker image building and optimization                                                                                                                                                                                    │ │
│ │ - Container registry management                                                                                                                                                                                             │ │
│ │ - Container orchestration deployment                                                                                                                                                                                        │ │
│ │ - Health monitoring and scaling                                                                                                                                                                                             │ │
│ │ - Container security best practices                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 1.3 Out of Scope                                                                                                                                                                                                        │ │
│ │ - Kubernetes deployment (see SOP-DEPLOY-003)                                                                                                                                                                                │ │
│ │ - Database containerization                                                                                                                                                                                                 │ │
│ │ - CI/CD pipeline configuration                                                                                                                                                                                              │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ## 2. DEFINITIONS AND ACRONYMS                                                                                                                                                                                              │ │
│ │                                                                                                                                                                                                                             │ │
│ │ | Term | Definition |                                                                                                                                                                                                       │ │
│ │ |------|------------|                                                                                                                                                                                                       │ │
│ │ | OCI | Open Container Initiative |                                                                                                                                                                                         │ │
│ │ | ECR | Elastic Container Registry (AWS) |                                                                                                                                                                                  │ │
│ │ | GCR | Google Container Registry |                                                                                                                                                                                         │ │
│ │ | GHCR | GitHub Container Registry |                                                                                                                                                                                        │ │
│ │ | HEALTHCHECK | Docker health monitoring instruction |                                                                                                                                                                      │ │
│ │ | Multi-stage | Build technique to reduce image size |                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ## 3. ROLES AND RESPONSIBILITIES                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                             │ │
│ │ | Role | Responsibilities |                                                                                                                                                                                                 │ │
│ │ |------|-----------------|                                                                                                                                                                                                  │ │
│ │ | DevOps Engineer | Build images, manage registries, deploy containers |                                                                                                                                                    │ │
│ │ | Security Officer | Scan images, approve base images, review Dockerfile |                                                                                                                                                  │ │
│ │ | Developer | Ensure application container-ready, provide build context |                                                                                                                                                   │ │
│ │ | SRE | Monitor container health, manage scaling policies |                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ## 4. PREREQUISITES AND REQUIRED RESOURCES                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 4.1 Prerequisites                                                                                                                                                                                                       │ │
│ │ - [ ] Docker Engine 24.0+ installed                                                                                                                                                                                         │ │
│ │ - [ ] Container registry access configured                                                                                                                                                                                  │ │
│ │ - [ ] Base image approved by security                                                                                                                                                                                       │ │
│ │ - [ ] Application tested in container locally                                                                                                                                                                               │ │
│ │ - [ ] Resource limits defined                                                                                                                                                                                               │ │
│ │ - [ ] Network policies documented                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 4.2 Required Resources                                                                                                                                                                                                  │ │
│ │ - Docker build environment (4GB RAM minimum)                                                                                                                                                                                │ │
│ │ - Container registry with 10GB storage                                                                                                                                                                                      │ │
│ │ - Production orchestration platform                                                                                                                                                                                         │ │
│ │ - Monitoring stack (Prometheus/Grafana)                                                                                                                                                                                     │ │
│ │ - Log aggregation system                                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 4.3 Security Requirements                                                                                                                                                                                               │ │
│ │ - Base image vulnerability scan passed                                                                                                                                                                                      │ │
│ │ - No secrets in image layers                                                                                                                                                                                                │ │
│ │ - Non-root user configured                                                                                                                                                                                                  │ │
│ │ - Read-only root filesystem capable                                                                                                                                                                                         │ │
│ │ - Security policies defined                                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ## 5. PROCEDURE                                                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 5.1 Docker Image Preparation                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.1.1 Create Optimized Dockerfile                                                                                                                                                                                      │ │
│ │ ```dockerfile                                                                                                                                                                                                               │ │
│ │ # Dockerfile                                                                                                                                                                                                                │ │
│ │ # Build stage                                                                                                                                                                                                               │ │
│ │ FROM node:20-alpine AS builder                                                                                                                                                                                              │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Install build dependencies                                                                                                                                                                                                │ │
│ │ RUN apk add --no-cache python3 make g++                                                                                                                                                                                     │ │
│ │                                                                                                                                                                                                                             │ │
│ │ WORKDIR /build                                                                                                                                                                                                              │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Copy dependency files                                                                                                                                                                                                     │ │
│ │ COPY package*.json ./                                                                                                                                                                                                       │ │
│ │ COPY tsconfig.json ./                                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Install all dependencies (including dev)                                                                                                                                                                                  │ │
│ │ RUN npm ci                                                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Copy source code                                                                                                                                                                                                          │ │
│ │ COPY src/ ./src/                                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Build application                                                                                                                                                                                                         │ │
│ │ RUN npm run build                                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Remove dev dependencies                                                                                                                                                                                                   │ │
│ │ RUN npm prune --production                                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Production stage                                                                                                                                                                                                          │ │
│ │ FROM node:20-alpine                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Install production dependencies only                                                                                                                                                                                      │ │
│ │ RUN apk add --no-cache tini curl                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Create non-root user                                                                                                                                                                                                      │ │
│ │ RUN addgroup -g 1001 chittyid && \                                                                                                                                                                                          │ │
│ │     adduser -u 1001 -G chittyid -D chittyid                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │ WORKDIR /app                                                                                                                                                                                                                │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Copy built application from builder                                                                                                                                                                                       │ │
│ │ COPY --from=builder --chown=chittyid:chittyid /build/dist ./dist                                                                                                                                                            │ │
│ │ COPY --from=builder --chown=chittyid:chittyid /build/node_modules ./node_modules                                                                                                                                            │ │
│ │ COPY --from=builder --chown=chittyid:chittyid /build/package*.json ./                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Create necessary directories                                                                                                                                                                                              │ │
│ │ RUN mkdir -p /app/logs /app/tmp && \                                                                                                                                                                                        │ │
│ │     chown -R chittyid:chittyid /app                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Switch to non-root user                                                                                                                                                                                                   │ │
│ │ USER chittyid                                                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Environment defaults                                                                                                                                                                                                      │ │
│ │ ENV NODE_ENV=production \                                                                                                                                                                                                   │ │
│ │     PORT=3000 \                                                                                                                                                                                                             │ │
│ │     HOST=0.0.0.0                                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Expose application port                                                                                                                                                                                                   │ │
│ │ EXPOSE 3000                                                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Health check                                                                                                                                                                                                              │ │
│ │ HEALTHCHECK --interval=30s --timeout=3s --start-period=40s --retries=3 \                                                                                                                                                    │ │
│ │   CMD curl -f http://localhost:3000/health || exit 1                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Use tini for proper signal handling                                                                                                                                                                                       │ │
│ │ ENTRYPOINT ["/sbin/tini", "--"]                                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Start application                                                                                                                                                                                                         │ │
│ │ CMD ["node", "dist/server-minimal.js"]                                                                                                                                                                                      │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.1.2 Create .dockerignore                                                                                                                                                                                             │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ cat > .dockerignore << 'EOF'                                                                                                                                                                                                │ │
│ │ # Dependencies                                                                                                                                                                                                              │ │
│ │ node_modules/                                                                                                                                                                                                               │ │
│ │ npm-debug.log*                                                                                                                                                                                                              │ │
│ │ yarn-debug.log*                                                                                                                                                                                                             │ │
│ │ yarn-error.log*                                                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Build outputs                                                                                                                                                                                                             │ │
│ │ dist/                                                                                                                                                                                                                       │ │
│ │ build/                                                                                                                                                                                                                      │ │
│ │ .next/                                                                                                                                                                                                                      │ │
│ │ out/                                                                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Environment files                                                                                                                                                                                                         │ │
│ │ .env*                                                                                                                                                                                                                       │ │
│ │ !.env.example                                                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Development files                                                                                                                                                                                                         │ │
│ │ .git/                                                                                                                                                                                                                       │ │
│ │ .gitignore                                                                                                                                                                                                                  │ │
│ │ .eslintrc*                                                                                                                                                                                                                  │ │
│ │ .prettierrc*                                                                                                                                                                                                                │ │
│ │ *.md                                                                                                                                                                                                                        │ │
│ │ docs/                                                                                                                                                                                                                       │ │
│ │ coverage/                                                                                                                                                                                                                   │ │
│ │ .nyc_output/                                                                                                                                                                                                                │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # IDE files                                                                                                                                                                                                                 │ │
│ │ .vscode/                                                                                                                                                                                                                    │ │
│ │ .idea/                                                                                                                                                                                                                      │ │
│ │ *.swp                                                                                                                                                                                                                       │ │
│ │ *.swo                                                                                                                                                                                                                       │ │
│ │ .DS_Store                                                                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Test files                                                                                                                                                                                                                │ │
│ │ **/*.test.ts                                                                                                                                                                                                                │ │
│ │ **/*.spec.ts                                                                                                                                                                                                                │ │
│ │ __tests__/                                                                                                                                                                                                                  │ │
│ │ test/                                                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Temporary files                                                                                                                                                                                                           │ │
│ │ tmp/                                                                                                                                                                                                                        │ │
│ │ temp/                                                                                                                                                                                                                       │ │
│ │ *.tmp                                                                                                                                                                                                                       │ │
│ │ *.log                                                                                                                                                                                                                       │ │
│ │ EOF                                                                                                                                                                                                                         │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 5.2 Build Process                                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.2.1 Build Image with Metadata                                                                                                                                                                                        │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Set build variables                                                                                                                                                                                                       │ │
│ │ export VERSION=$(git describe --tags --always)                                                                                                                                                                              │ │
│ │ export BUILD_DATE=$(date -u +"%Y-%m-%dT%H:%M:%SZ")                                                                                                                                                                          │ │
│ │ export GIT_COMMIT=$(git rev-parse HEAD)                                                                                                                                                                                     │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Build with labels                                                                                                                                                                                                         │ │
│ │ docker build \                                                                                                                                                                                                              │ │
│ │   --label "org.opencontainers.image.created=${BUILD_DATE}" \                                                                                                                                                                │ │
│ │   --label "org.opencontainers.image.version=${VERSION}" \                                                                                                                                                                   │ │
│ │   --label "org.opencontainers.image.revision=${GIT_COMMIT}" \                                                                                                                                                               │ │
│ │   --label "org.opencontainers.image.title=ChittyID" \                                                                                                                                                                       │ │
│ │   --label "org.opencontainers.image.description=Universal Identity System" \                                                                                                                                                │ │
│ │   --label "org.opencontainers.image.vendor=ChittyCorp" \                                                                                                                                                                    │ │
│ │   --label "org.opencontainers.image.url=https://id.chitty.cc" \                                                                                                                                                             │ │
│ │   --label "org.opencontainers.image.source=https://github.com/chittycorp/chittyid" \                                                                                                                                        │ │
│ │   --tag chittyid:${VERSION} \                                                                                                                                                                                               │ │
│ │   --tag chittyid:latest \                                                                                                                                                                                                   │ │
│ │   .                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Verify build                                                                                                                                                                                                              │ │
│ │ docker images chittyid:${VERSION}                                                                                                                                                                                           │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.2.2 Security Scanning                                                                                                                                                                                                │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Scan with Trivy                                                                                                                                                                                                           │ │
│ │ docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \                                                                                                                                                              │ │
│ │   aquasec/trivy image chittyid:${VERSION}                                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Export scan results                                                                                                                                                                                                       │ │
│ │ docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \                                                                                                                                                              │ │
│ │   -v $(pwd):/output \                                                                                                                                                                                                       │ │
│ │   aquasec/trivy image --format json \                                                                                                                                                                                       │ │
│ │   --output /output/scan-results.json \                                                                                                                                                                                      │ │
│ │   chittyid:${VERSION}                                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Check for critical vulnerabilities                                                                                                                                                                                        │ │
│ │ if grep -q '"Severity": "CRITICAL"' scan-results.json; then                                                                                                                                                                 │ │
│ │   echo "CRITICAL vulnerabilities found!"                                                                                                                                                                                    │ │
│ │   exit 1                                                                                                                                                                                                                    │ │
│ │ fi                                                                                                                                                                                                                          │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.2.3 Image Optimization Verification                                                                                                                                                                                  │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Check image size                                                                                                                                                                                                          │ │
│ │ docker images chittyid:${VERSION} --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"                                                                                                                                     │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Verify single process                                                                                                                                                                                                     │ │
│ │ docker run --rm chittyid:${VERSION} ps aux                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Check layer efficiency                                                                                                                                                                                                    │ │
│ │ docker history chittyid:${VERSION}                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Test as non-root                                                                                                                                                                                                          │ │
│ │ docker run --rm chittyid:${VERSION} whoami                                                                                                                                                                                  │ │
│ │ # Should output: chittyid                                                                                                                                                                                                   │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 5.3 Registry Management                                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.3.1 Tag for Registry                                                                                                                                                                                                 │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # For AWS ECR                                                                                                                                                                                                               │ │
│ │ REGISTRY_URL=123456789.dkr.ecr.us-east-1.amazonaws.com                                                                                                                                                                      │ │
│ │ docker tag chittyid:${VERSION} ${REGISTRY_URL}/chittyid:${VERSION}                                                                                                                                                          │ │
│ │ docker tag chittyid:${VERSION} ${REGISTRY_URL}/chittyid:latest                                                                                                                                                              │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # For Docker Hub                                                                                                                                                                                                            │ │
│ │ docker tag chittyid:${VERSION} chittycorp/chittyid:${VERSION}                                                                                                                                                               │ │
│ │ docker tag chittyid:${VERSION} chittycorp/chittyid:latest                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # For GitHub Container Registry                                                                                                                                                                                             │ │
│ │ docker tag chittyid:${VERSION} ghcr.io/chittycorp/chittyid:${VERSION}                                                                                                                                                       │ │
│ │ docker tag chittyid:${VERSION} ghcr.io/chittycorp/chittyid:latest                                                                                                                                                           │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.3.2 Push to Registry                                                                                                                                                                                                 │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Login to registry                                                                                                                                                                                                         │ │
│ │ # AWS ECR                                                                                                                                                                                                                   │ │
│ │ aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin ${REGISTRY_URL}                                                                                                                │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Docker Hub                                                                                                                                                                                                                │ │
│ │ docker login -u ${DOCKER_USERNAME} -p ${DOCKER_PASSWORD}                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # GitHub Container Registry                                                                                                                                                                                                 │ │
│ │ echo ${GITHUB_TOKEN} | docker login ghcr.io -u ${GITHUB_USER} --password-stdin                                                                                                                                              │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Push images                                                                                                                                                                                                               │ │
│ │ docker push ${REGISTRY_URL}/chittyid:${VERSION}                                                                                                                                                                             │ │
│ │ docker push ${REGISTRY_URL}/chittyid:latest                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Verify push                                                                                                                                                                                                               │ │
│ │ docker pull ${REGISTRY_URL}/chittyid:${VERSION}                                                                                                                                                                             │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 5.4 Deployment Configuration                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.4.1 Create Docker Compose for Production                                                                                                                                                                             │ │
│ │ ```yaml                                                                                                                                                                                                                     │ │
│ │ # docker-compose.prod.yml                                                                                                                                                                                                   │ │
│ │ version: '3.8'                                                                                                                                                                                                              │ │
│ │                                                                                                                                                                                                                             │ │
│ │ services:                                                                                                                                                                                                                   │ │
│ │   chittyid:                                                                                                                                                                                                                 │ │
│ │     image: ${REGISTRY_URL}/chittyid:${VERSION:-latest}                                                                                                                                                                      │ │
│ │     container_name: chittyid-prod                                                                                                                                                                                           │ │
│ │     restart: unless-stopped                                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │     ports:                                                                                                                                                                                                                  │ │
│ │       - "3000:3000"                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │     environment:                                                                                                                                                                                                            │ │
│ │       - NODE_ENV=production                                                                                                                                                                                                 │ │
│ │       - PORT=3000                                                                                                                                                                                                           │ │
│ │       - HOST=0.0.0.0                                                                                                                                                                                                        │ │
│ │       - DATABASE_URL=${DATABASE_URL}                                                                                                                                                                                        │ │
│ │       - CHITTYID_NODE_ID=${CHITTYID_NODE_ID:-1}                                                                                                                                                                             │ │
│ │       - CHITTYID_DEFAULT_JURISDICTION=${CHITTYID_DEFAULT_JURISDICTION:-USA}                                                                                                                                                 │ │
│ │       - MAX_BATCH_SIZE=1000                                                                                                                                                                                                 │ │
│ │       - TARGET_TPS=3420                                                                                                                                                                                                     │ │
│ │                                                                                                                                                                                                                             │ │
│ │     volumes:                                                                                                                                                                                                                │ │
│ │       - ./logs:/app/logs:rw                                                                                                                                                                                                 │ │
│ │       - /app/node_modules  # Anonymous volume for node_modules                                                                                                                                                              │ │
│ │                                                                                                                                                                                                                             │ │
│ │     networks:                                                                                                                                                                                                               │ │
│ │       - chittyid-network                                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                             │ │
│ │     deploy:                                                                                                                                                                                                                 │ │
│ │       resources:                                                                                                                                                                                                            │ │
│ │         limits:                                                                                                                                                                                                             │ │
│ │           cpus: '2'                                                                                                                                                                                                         │ │
│ │           memory: 2G                                                                                                                                                                                                        │ │
│ │         reservations:                                                                                                                                                                                                       │ │
│ │           cpus: '1'                                                                                                                                                                                                         │ │
│ │           memory: 1G                                                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                                             │ │
│ │     healthcheck:                                                                                                                                                                                                            │ │
│ │       test: ["CMD", "curl", "-f", "http://localhost:3000/health"]                                                                                                                                                           │ │
│ │       interval: 30s                                                                                                                                                                                                         │ │
│ │       timeout: 10s                                                                                                                                                                                                          │ │
│ │       retries: 3                                                                                                                                                                                                            │ │
│ │       start_period: 40s                                                                                                                                                                                                     │ │
│ │                                                                                                                                                                                                                             │ │
│ │     logging:                                                                                                                                                                                                                │ │
│ │       driver: "json-file"                                                                                                                                                                                                   │ │
│ │       options:                                                                                                                                                                                                              │ │
│ │         max-size: "10m"                                                                                                                                                                                                     │ │
│ │         max-file: "3"                                                                                                                                                                                                       │ │
│ │         labels: "service=chittyid"                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                             │ │
│ │     labels:                                                                                                                                                                                                                 │ │
│ │       - "traefik.enable=true"                                                                                                                                                                                               │ │
│ │       - "traefik.http.routers.chittyid.rule=Host(`id.chitty.cc`)"                                                                                                                                                           │ │
│ │       - "traefik.http.routers.chittyid.tls=true"                                                                                                                                                                            │ │
│ │       - "traefik.http.routers.chittyid.tls.certresolver=letsencrypt"                                                                                                                                                        │ │
│ │       - "prometheus.io/scrape=true"                                                                                                                                                                                         │ │
│ │       - "prometheus.io/port=9090"                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                             │ │
│ │   # Optional: Nginx reverse proxy                                                                                                                                                                                           │ │
│ │   nginx:                                                                                                                                                                                                                    │ │
│ │     image: nginx:alpine                                                                                                                                                                                                     │ │
│ │     container_name: chittyid-nginx                                                                                                                                                                                          │ │
│ │     restart: unless-stopped                                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │     ports:                                                                                                                                                                                                                  │ │
│ │       - "80:80"                                                                                                                                                                                                             │ │
│ │       - "443:443"                                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                             │ │
│ │     volumes:                                                                                                                                                                                                                │ │
│ │       - ./nginx.conf:/etc/nginx/nginx.conf:ro                                                                                                                                                                               │ │
│ │       - ./ssl:/etc/nginx/ssl:ro                                                                                                                                                                                             │ │
│ │       - nginx-cache:/var/cache/nginx                                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                                             │ │
│ │     networks:                                                                                                                                                                                                               │ │
│ │       - chittyid-network                                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                             │ │
│ │     depends_on:                                                                                                                                                                                                             │ │
│ │       chittyid:                                                                                                                                                                                                             │ │
│ │         condition: service_healthy                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                             │ │
│ │ networks:                                                                                                                                                                                                                   │ │
│ │   chittyid-network:                                                                                                                                                                                                         │ │
│ │     driver: bridge                                                                                                                                                                                                          │ │
│ │     ipam:                                                                                                                                                                                                                   │ │
│ │       config:                                                                                                                                                                                                               │ │
│ │         - subnet: 172.20.0.0/16                                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                                             │ │
│ │ volumes:                                                                                                                                                                                                                    │ │
│ │   nginx-cache:                                                                                                                                                                                                              │ │
│ │     driver: local                                                                                                                                                                                                           │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.4.2 Create Environment File                                                                                                                                                                                          │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # .env.production                                                                                                                                                                                                           │ │
│ │ cat > .env.production << 'EOF'                                                                                                                                                                                              │ │
│ │ # Registry Configuration                                                                                                                                                                                                    │ │
│ │ REGISTRY_URL=123456789.dkr.ecr.us-east-1.amazonaws.com                                                                                                                                                                      │ │
│ │ VERSION=1.0.0                                                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Database Configuration                                                                                                                                                                                                    │ │
│ │ DATABASE_URL=postgresql://chittyid:${DB_PASSWORD}@db.chitty.cc:5432/chittyid                                                                                                                                                │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # ChittyID Configuration                                                                                                                                                                                                    │ │
│ │ CHITTYID_NODE_ID=1                                                                                                                                                                                                          │ │
│ │ CHITTYID_DEFAULT_JURISDICTION=USA                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Performance Tuning                                                                                                                                                                                                        │ │
│ │ NODE_OPTIONS=--max-old-space-size=1536                                                                                                                                                                                      │ │
│ │ UV_THREADPOOL_SIZE=16                                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Monitoring                                                                                                                                                                                                                │ │
│ │ ENABLE_METRICS=true                                                                                                                                                                                                         │ │
│ │ METRICS_PORT=9090                                                                                                                                                                                                           │ │
│ │ EOF                                                                                                                                                                                                                         │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 5.5 Deployment Execution                                                                                                                                                                                                │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.5.1 Deploy Single Container                                                                                                                                                                                          │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Stop existing container                                                                                                                                                                                                   │ │
│ │ docker stop chittyid-prod || true                                                                                                                                                                                           │ │
│ │ docker rm chittyid-prod || true                                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Run new container                                                                                                                                                                                                         │ │
│ │ docker run -d \                                                                                                                                                                                                             │ │
│ │   --name chittyid-prod \                                                                                                                                                                                                    │ │
│ │   --restart unless-stopped \                                                                                                                                                                                                │ │
│ │   --memory="2g" \                                                                                                                                                                                                           │ │
│ │   --memory-swap="2g" \                                                                                                                                                                                                      │ │
│ │   --cpus="2.0" \                                                                                                                                                                                                            │ │
│ │   -p 3000:3000 \                                                                                                                                                                                                            │ │
│ │   --env-file .env.production \                                                                                                                                                                                              │ │
│ │   -v $(pwd)/logs:/app/logs:rw \                                                                                                                                                                                             │ │
│ │   --health-cmd="curl -f http://localhost:3000/health || exit 1" \                                                                                                                                                           │ │
│ │   --health-interval=30s \                                                                                                                                                                                                   │ │
│ │   --health-timeout=10s \                                                                                                                                                                                                    │ │
│ │   --health-retries=3 \                                                                                                                                                                                                      │ │
│ │   --health-start-period=40s \                                                                                                                                                                                               │ │
│ │   ${REGISTRY_URL}/chittyid:${VERSION}                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Verify deployment                                                                                                                                                                                                         │ │
│ │ docker ps -a | grep chittyid                                                                                                                                                                                                │ │
│ │ docker logs -f chittyid-prod --tail=50                                                                                                                                                                                      │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.5.2 Deploy with Docker Compose                                                                                                                                                                                       │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Pull latest images                                                                                                                                                                                                        │ │
│ │ docker-compose -f docker-compose.prod.yml pull                                                                                                                                                                              │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Deploy with zero downtime                                                                                                                                                                                                 │ │
│ │ docker-compose -f docker-compose.prod.yml up -d --scale chittyid=2                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Wait for health                                                                                                                                                                                                           │ │
│ │ sleep 30                                                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Remove old containers                                                                                                                                                                                                     │ │
│ │ docker-compose -f docker-compose.prod.yml up -d --scale chittyid=1 --no-recreate                                                                                                                                            │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Verify deployment                                                                                                                                                                                                         │ │
│ │ docker-compose -f docker-compose.prod.yml ps                                                                                                                                                                                │ │
│ │ docker-compose -f docker-compose.prod.yml logs --tail=50                                                                                                                                                                    │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 5.6 Container Management                                                                                                                                                                                                │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.6.1 Health Monitoring                                                                                                                                                                                                │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Check container health                                                                                                                                                                                                    │ │
│ │ docker inspect chittyid-prod --format='{{.State.Health.Status}}'                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # View health check history                                                                                                                                                                                                 │ │
│ │ docker inspect chittyid-prod --format='{{json .State.Health.Log}}' | jq                                                                                                                                                     │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Monitor resource usage                                                                                                                                                                                                    │ │
│ │ docker stats chittyid-prod --no-stream                                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Check running processes                                                                                                                                                                                                   │ │
│ │ docker top chittyid-prod                                                                                                                                                                                                    │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.6.2 Log Management                                                                                                                                                                                                   │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # View logs                                                                                                                                                                                                                 │ │
│ │ docker logs chittyid-prod --tail=100 --follow                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Export logs                                                                                                                                                                                                               │ │
│ │ docker logs chittyid-prod > chittyid-$(date +%Y%m%d).log                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Search logs                                                                                                                                                                                                               │ │
│ │ docker logs chittyid-prod 2>&1 | grep ERROR                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Log rotation (if not using log driver)                                                                                                                                                                                    │ │
│ │ docker run --rm -v /var/lib/docker/containers:/var/lib/docker/containers alpine \                                                                                                                                           │ │
│ │   sh -c 'truncate -s 0 /var/lib/docker/containers/*/*-json.log'                                                                                                                                                             │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.6.3 Container Maintenance                                                                                                                                                                                            │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Update container without downtime                                                                                                                                                                                         │ │
│ │ docker pull ${REGISTRY_URL}/chittyid:latest                                                                                                                                                                                 │ │
│ │ docker run -d --name chittyid-new [options] ${REGISTRY_URL}/chittyid:latest                                                                                                                                                 │ │
│ │ # Test new container                                                                                                                                                                                                        │ │
│ │ curl http://localhost:3001/health                                                                                                                                                                                           │ │
│ │ # Switch traffic (update load balancer)                                                                                                                                                                                     │ │
│ │ docker stop chittyid-prod                                                                                                                                                                                                   │ │
│ │ docker rename chittyid-new chittyid-prod                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Clean up unused resources                                                                                                                                                                                                 │ │
│ │ docker system prune -a --volumes                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Backup container data                                                                                                                                                                                                     │ │
│ │ docker run --rm --volumes-from chittyid-prod \                                                                                                                                                                              │ │
│ │   -v $(pwd)/backup:/backup alpine \                                                                                                                                                                                         │ │
│ │   tar czf /backup/chittyid-backup-$(date +%Y%m%d).tar.gz /app/logs                                                                                                                                                          │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 5.7 Scaling and Load Balancing                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.7.1 Manual Scaling                                                                                                                                                                                                   │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Scale up                                                                                                                                                                                                                  │ │
│ │ for i in {1..3}; do                                                                                                                                                                                                         │ │
│ │   docker run -d \                                                                                                                                                                                                           │ │
│ │     --name chittyid-prod-${i} \                                                                                                                                                                                             │ │
│ │     --restart unless-stopped \                                                                                                                                                                                              │ │
│ │     -p 300${i}:3000 \                                                                                                                                                                                                       │ │
│ │     --env-file .env.production \                                                                                                                                                                                            │ │
│ │     ${REGISTRY_URL}/chittyid:${VERSION}                                                                                                                                                                                     │ │
│ │ done                                                                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Configure load balancer (nginx example)                                                                                                                                                                                   │ │
│ │ cat > nginx-lb.conf << 'EOF'                                                                                                                                                                                                │ │
│ │ upstream chittyid_backend {                                                                                                                                                                                                 │ │
│ │     least_conn;                                                                                                                                                                                                             │ │
│ │     server 127.0.0.1:3001 max_fails=3 fail_timeout=30s;                                                                                                                                                                     │ │
│ │     server 127.0.0.1:3002 max_fails=3 fail_timeout=30s;                                                                                                                                                                     │ │
│ │     server 127.0.0.1:3003 max_fails=3 fail_timeout=30s;                                                                                                                                                                     │ │
│ │ }                                                                                                                                                                                                                           │ │
│ │ EOF                                                                                                                                                                                                                         │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ #### 5.7.2 Auto-scaling with Docker Swarm                                                                                                                                                                                   │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Initialize swarm (if not already)                                                                                                                                                                                         │ │
│ │ docker swarm init                                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Create service                                                                                                                                                                                                            │ │
│ │ docker service create \                                                                                                                                                                                                     │ │
│ │   --name chittyid \                                                                                                                                                                                                         │ │
│ │   --replicas 3 \                                                                                                                                                                                                            │ │
│ │   --publish published=3000,target=3000 \                                                                                                                                                                                    │ │
│ │   --env-file .env.production \                                                                                                                                                                                              │ │
│ │   --limit-memory 2G \                                                                                                                                                                                                       │ │
│ │   --reserve-memory 1G \                                                                                                                                                                                                     │ │
│ │   --update-parallelism 1 \                                                                                                                                                                                                  │ │
│ │   --update-delay 30s \                                                                                                                                                                                                      │ │
│ │   --restart-condition any \                                                                                                                                                                                                 │ │
│ │   --restart-delay 5s \                                                                                                                                                                                                      │ │
│ │   --restart-max-attempts 3 \                                                                                                                                                                                                │ │
│ │   ${REGISTRY_URL}/chittyid:${VERSION}                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Scale service                                                                                                                                                                                                             │ │
│ │ docker service scale chittyid=5                                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Update service                                                                                                                                                                                                            │ │
│ │ docker service update --image ${REGISTRY_URL}/chittyid:${NEW_VERSION} chittyid                                                                                                                                              │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ## 6. QUALITY CHECKPOINTS                                                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                                             │ │
│ │ | Checkpoint | Verification Method | Success Criteria |                                                                                                                                                                     │ │
│ │ |------------|-------------------|------------------|                                                                                                                                                                       │ │
│ │ | Dockerfile Optimized | Image size check | < 150MB alpine-based |                                                                                                                                                          │ │
│ │ | Security Scan Clean | Trivy scan | No HIGH/CRITICAL vulns |                                                                                                                                                               │ │
│ │ | Non-root User | docker run whoami | Returns 'chittyid' |                                                                                                                                                                  │ │
│ │ | Health Check Works | docker inspect | Status: healthy |                                                                                                                                                                   │ │
│ │ | Resource Limits Set | docker inspect | Memory/CPU limits defined |                                                                                                                                                        │ │
│ │ | Logs Accessible | docker logs | Structured log output |                                                                                                                                                                   │ │
│ │ | Graceful Shutdown | docker stop (time) | Stops within 30 seconds |                                                                                                                                                        │ │
│ │ | Performance Target | Load test in container | TPS > 3,420 |                                                                                                                                                               │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ## 7. TROUBLESHOOTING GUIDE                                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 7.1 Common Issues and Solutions                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ | Issue | Symptoms | Solution |                                                                                                                                                                                             │ │
│ │ |-------|----------|----------|                                                                                                                                                                                             │ │
│ │ | Container Exits | Status: Exited (1) | Check logs: `docker logs chittyid-prod` |                                                                                                                                          │ │
│ │ | Health Check Fails | Status: unhealthy | Exec into container, test endpoint manually |                                                                                                                                    │ │
│ │ | Memory Issues | Container killed | Increase memory limit, check for leaks |                                                                                                                                               │ │
│ │ | Permission Denied | Cannot write logs | Fix volume permissions: `chown -R 1001:1001 ./logs` |                                                                                                                             │ │
│ │ | Network Issues | Cannot connect | Check docker network: `docker network inspect` |                                                                                                                                        │ │
│ │ | Slow Startup | Health check timeout | Increase start_period in health check |                                                                                                                                             │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 7.2 Debugging Commands                                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Execute commands in running container                                                                                                                                                                                     │ │
│ │ docker exec -it chittyid-prod sh                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Check environment variables                                                                                                                                                                                               │ │
│ │ docker exec chittyid-prod env | sort                                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Test internal connectivity                                                                                                                                                                                                │ │
│ │ docker exec chittyid-prod curl http://localhost:3000/health                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # View container details                                                                                                                                                                                                    │ │
│ │ docker inspect chittyid-prod | jq                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Monitor real-time events                                                                                                                                                                                                  │ │
│ │ docker events --filter container=chittyid-prod                                                                                                                                                                              │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Export container for analysis                                                                                                                                                                                             │ │
│ │ docker export chittyid-prod > container-export.tar                                                                                                                                                                          │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ## 8. SECURITY BEST PRACTICES                                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 8.1 Image Security                                                                                                                                                                                                      │ │
│ │ - Use specific version tags, never 'latest' in production                                                                                                                                                                   │ │
│ │ - Scan all images before deployment                                                                                                                                                                                         │ │
│ │ - Use minimal base images (alpine)                                                                                                                                                                                          │ │
│ │ - Don't run as root                                                                                                                                                                                                         │ │
│ │ - Remove unnecessary packages                                                                                                                                                                                               │ │
│ │ - Use multi-stage builds                                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 8.2 Runtime Security                                                                                                                                                                                                    │ │
│ │ ```yaml                                                                                                                                                                                                                     │ │
│ │ # Security options in docker-compose                                                                                                                                                                                        │ │
│ │ security_opt:                                                                                                                                                                                                               │ │
│ │   - no-new-privileges:true                                                                                                                                                                                                  │ │
│ │   - seccomp:unconfined                                                                                                                                                                                                      │ │
│ │ cap_drop:                                                                                                                                                                                                                   │ │
│ │   - ALL                                                                                                                                                                                                                     │ │
│ │ cap_add:                                                                                                                                                                                                                    │ │
│ │   - NET_BIND_SERVICE                                                                                                                                                                                                        │ │
│ │ read_only: true                                                                                                                                                                                                             │ │
│ │ tmpfs:                                                                                                                                                                                                                      │ │
│ │   - /tmp                                                                                                                                                                                                                    │ │
│ │   - /app/tmp                                                                                                                                                                                                                │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 8.3 Secret Management                                                                                                                                                                                                   │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Use Docker secrets (Swarm mode)                                                                                                                                                                                           │ │
│ │ echo "mypassword" | docker secret create db_password -                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Reference in service                                                                                                                                                                                                      │ │
│ │ docker service create \                                                                                                                                                                                                     │ │
│ │   --secret db_password \                                                                                                                                                                                                    │ │
│ │   --env DATABASE_URL=postgresql://user:@db/chittyid?password_file=/run/secrets/db_password \                                                                                                                                │ │
│ │   chittyid                                                                                                                                                                                                                  │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ## 9. MONITORING AND OBSERVABILITY                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 9.1 Metrics Collection                                                                                                                                                                                                  │ │
│ │ ```yaml                                                                                                                                                                                                                     │ │
│ │ # Prometheus metrics endpoint                                                                                                                                                                                               │ │
│ │ metrics:                                                                                                                                                                                                                    │ │
│ │   image: prom/node-exporter:latest                                                                                                                                                                                          │ │
│ │   container_name: chittyid-metrics                                                                                                                                                                                          │ │
│ │   ports:                                                                                                                                                                                                                    │ │
│ │     - "9100:9100"                                                                                                                                                                                                           │ │
│ │   volumes:                                                                                                                                                                                                                  │ │
│ │     - /proc:/host/proc:ro                                                                                                                                                                                                   │ │
│ │     - /sys:/host/sys:ro                                                                                                                                                                                                     │ │
│ │     - /:/rootfs:ro                                                                                                                                                                                                          │ │
│ │   command:                                                                                                                                                                                                                  │ │
│ │     - '--path.procfs=/host/proc'                                                                                                                                                                                            │ │
│ │     - '--path.sysfs=/host/sys'                                                                                                                                                                                              │ │
│ │     - '--path.rootfs=/rootfs'                                                                                                                                                                                               │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### 9.2 Container Dashboards                                                                                                                                                                                                │ │
│ │ - Container count and status                                                                                                                                                                                                │ │
│ │ - CPU and memory usage                                                                                                                                                                                                      │ │
│ │ - Network I/O                                                                                                                                                                                                               │ │
│ │ - Disk usage                                                                                                                                                                                                                │ │
│ │ - Request rate and latency                                                                                                                                                                                                  │ │
│ │ - Error rate                                                                                                                                                                                                                │ │
│ │ - Health check status                                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ## 10. APPENDICES                                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### Appendix A: Quick Reference Commands                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Build and run locally                                                                                                                                                                                                     │ │
│ │ docker build -t chittyid:local . && docker run -p 3000:3000 chittyid:local                                                                                                                                                  │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # View container filesystem                                                                                                                                                                                                 │ │
│ │ docker run --rm -it chittyid:latest sh                                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Copy files from container                                                                                                                                                                                                 │ │
│ │ docker cp chittyid-prod:/app/logs/app.log ./                                                                                                                                                                                │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Monitor multiple containers                                                                                                                                                                                               │ │
│ │ docker stats $(docker ps --format "table {{.Names}}" | grep chittyid)                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Clean everything                                                                                                                                                                                                          │ │
│ │ docker stop $(docker ps -aq)                                                                                                                                                                                                │ │
│ │ docker system prune -a --volumes                                                                                                                                                                                            │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### Appendix B: Migration from PM2 to Docker                                                                                                                                                                                │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ```bash                                                                                                                                                                                                                     │ │
│ │ # Export PM2 config                                                                                                                                                                                                         │ │
│ │ pm2 show chittyid > pm2-config.txt                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Convert environment variables                                                                                                                                                                                             │ │
│ │ pm2 env chittyid | grep -v PM2 > docker.env                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                             │ │
│ │ # Test equivalent Docker command                                                                                                                                                                                            │ │
│ │ docker run --env-file docker.env [...]                                                                                                                                                                                      │ │
│ │ ```                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ### Appendix C: Container Orchestration Comparison                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                             │ │
│ │ | Feature | Docker Compose | Docker Swarm | Kubernetes |                                                                                                                                                                    │ │
│ │ |---------|---------------|--------------|------------|                                                                                                                                                                     │ │
│ │ | Complexity | Low | Medium | High |                                                                                                                                                                                        │ │
│ │ | Scaling | Manual | Automatic | Automatic |                                                                                                                                                                                │ │
│ │ | Load Balancing | External | Built-in | Built-in |                                                                                                                                                                         │ │
│ │ | Rolling Updates | Basic | Yes | Advanced |                                                                                                                                                                                │ │
│ │ | Health Checks | Yes | Yes | Yes |                                                                                                                                                                                         │ │
│ │ | Suitable For | Single host | Multi-host | Enterprise |                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ## 11. REVISION HISTORY                                                                                                                                                                                                     │ │
│ │                                                                                                                                                                                                                             │ │
│ │ | Version | Date | Author | Changes |                                                                                                                                                                                       │ │
│ │ |---------|------|--------|---------|                                                                                                                                                                                       │ │
│ │ | 1.0 | 2025-08-13 | SOP Queen | Initial Docker deployment procedures |                                                                                                                                                     │ │
│ │                                                                                                                                                                                                                             │ │
│ │ ---                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                             │ │
│ │ **Next Review Date**: 2025-11-13                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                             │ │
│ │ **Distribution**: DevOps Team, Development Team, Security Team                                                                                                                                                              │ │
│ │                                                                                                                                                                                                                             │ │
│ │ **Filing**: Store in /procedures/deployment/docker/     